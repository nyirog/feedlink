#!/usr/bin/env python
from argparse import ArgumentParser, FileType
from sys import argv, stdin, stdout, path
from os.path import dirname, realpath

basedir = realpath(dirname(__file__)+'/..')


def get_options(args):
    parser = ArgumentParser(
        description='get the feed links from html files')
    parser.add_argument('html', nargs='?', type=FileType('r'),
        default=stdin, help='name of the input html file')
    parser.add_argument('--json', nargs='?', type=FileType('w'),
        default=stdout, help='name of the output json file')
    parser.add_argument('--local', action='store_true', default=False,
        help='run the script localy before installation')

    options = parser.parse_args(args)
    return vars(options)

def main(html, json):
    body =  html.read()
    for link in get_links(body):
        print link
    return

if __name__ == '__main__':
    options = get_options(argv[1:])
    if options.pop('local'):
        path.append(basedir + '/src')
    from feedlink.linkreader import get_links

    status = main(**options)
    exit(status)

